---
title: "Final Presentation"
output:
  html_document:
    css: styles.css
---

#Introduction to Hack-a-Shaq

##What is a Hack-a-Shaq?

<div style="text-align: center;" align = "center">

<iframe width="640" height="480" align = "center" src="https://www.youtube.com/embed/-S_soY5Jg_Q" frameborder="0" allowfullscreen></iframe>

</div>
<br><br>
<br><br>
<br><br>
<br><br>


##Why Hack-a-Shaq....
###or a-Jordan, or a-Drummond, or a-Howard?
<div style="text-align: center;" align = "center">
  <span class="slide" style="float:center;width: 80%;">
  <IMG SRC="../figs/Three.png" float = "center" ALT="image" width="800">
  </span>
</div>

<br><br>
<br><br>
<br><br>
<br><br>


#What do they have in common?

<div style="text-align: center;" align = "center">
<iframe width="640" height="360" src="https://www.youtube.com/embed/YwYXAzsTsdw" frameborder="0" allowfullscreen></iframe>
</div>

<br><br>
<br><br>
<br><br>

##How much do they make?


###19.690 million USD
That's 19.57million more than an average data scientist makes per year!


```{r,echo=FALSE,message=FALSE,warning=FALSE}
setwd("/Users/sunxiaohan/Desktop/github/finalproject-p5-team3")
#setwd("/Users/bobminnich/Documents/Columbia/Courses/Applied_Data_Science/FinalProject/finalproject-p5-team3")
library(dplyr)
library(grid)
library(gridExtra)

# library(ggplot2)
# load("income.Rdata")
# 
# ggplot(income, aes(x=PINCP)) +
#   geom_density(alpha=.3)
#   
# geom_histogram(bins = 30) + 
#   geom_vline(xintercept = lowbound)+
#  annotate("text", x = lowbound + 4, y = height, label = "Hack-A-Jordan")+
#    annotate("text", x = lowbound-3, y = height, label = "No Hack")+
#   ggtitle("LA Clippers - Jordan")+
#     xlab("Number of Free Throws Per Game")+
#     ylab("Number of Games")

load("data/ClippersTwoMinIntervals.RData")
load("data/PistonsTwoMinIntervals.RData")
load("data/RocketsTwoMinIntervals.RData")

all_df = rbind(TWOMINS1,TWOMINS2,TWOMINS3)

```
<br><br>
<br><br>
<br><br>
<br><br>


#In the News
<IMG SRC="../figs/News.jpg" float = "center" ALT="image">

<br><br>
<br><br>
<br><br>
<br><br>


#Overall Question: Does Hack-A-Shaq work?


```{r,echo=FALSE,message=FALSE,warning=FALSE}
library(ggplot2)
library(plotly)
setwd("/Users/sunxiaohan/Desktop/github/finalproject-p5-team3")
#setwd("/Users/bobminnich/Documents/Columbia/Courses/Applied_Data_Science/FinalProject/finalproject-p5-team3")
load('Data/playerstatsData.Rdata')

#Tow special case
dj=playerstatsData[107,]  #Deandre Jordan
dh=playerstatsData[130,] # Dwight Howard
```


  
  
#But how do we define bad?



```{r,echo=FALSE,message=FALSE,warning=FALSE}
playerstatsData$FT_PCT=as.numeric(playerstatsData$FT_PCT)
data.ftpct=playerstatsData[order(playerstatsData$FT_PCT),c('PLAYER_NAME','TEAM_ABBREVIATION','FT_PCT')]
ind=seq(1:dim(data.ftpct)[1])
data.ftpct['ind']=ind
#data.ftpct[31,]
#data.ftpct[63,]

p=ggplot(data=data.ftpct,aes(x=ind,y=FT_PCT))+geom_point(aes(text=paste('Name:',PLAYER_NAME)))+ggtitle('Overall Distribution of FT_PCT')+ylab('FT_PCT')+
  geom_point(x=data.ftpct[31,'ind'],y=data.ftpct[31,'FT_PCT'],color='red')+
  #geom_text(x=data.ftpct[31,'ind']+30,y=data.ftpct[31,'FT_PCT']-10,label=data.ftpct$PLAYER_NAME[31],color='red',size=0.2)+
  geom_point(x=data.ftpct[63,'ind'],y=data.ftpct[63,'FT_PCT'],color='blue') +
  coord_flip()
  
  #+
  #geom_text(x=data.ftpct[63,'ind']+30,y=data.ftpct[63,'PT_PCT']-10,label=data.ftpct$PLAYER_NAME[63],color='blue')
  
gg <- ggplotly(p)
#gg


```








# Scatter plot of FTA and FT%
```{r,results='asis',tidy=FALSE, echo=FALSE, fig.align='center', warning=FALSE}
setwd("/Users/sunxiaohan/Desktop/github/finalproject-p5-team3")
#setwd("/Users/bobminnich/Documents/Columbia/Courses/Applied_Data_Science/FinalProject/finalproject-p5-team3")

load('Data/playerstatsData.Rdata')
note=playerstatsData[c(107,130,20,259),]  #Deandre Jordan and DH


a=list()
for (i in 1:4){
  m=note[i,]
  a[[i]]=list(
    x=m$FT_PCT,
    y=m$FTA,
    text=m$PLAYER_NAME,
    xref = "x",
    yref = "y",
    showarrow = TRUE,
    arrowhead = 7,
    ax = 20,
    ay = -40
  )
}

plot_ly(playerstatsData,x = FT_PCT, y =FTA ,
        text=paste('Name:',playerstatsData$PLAYER_NAME),
        mode = "markers", color = playerstatsData$FT_PCT)%>%layout(annotations = a)



```
<br><br>
<br><br>
<br><br>
<br><br>


#How did we determine Hack Games?

<div style="text-align: center;">

  <span style="float:left;width: 50%;">
  <IMG SRC="../figs/Clippers_Dist.png" float = "right" ALT="image">
  </span>
  
  <span style="float:right;width: 50%;">
  <IMG SRC="../figs/Pistons_Dist.png" float = "right" ALT="image">
  </span>
  <IMG SRC="../figs/Rockets_Dist.png" float = "center" ALT="image">

</div>
<br><br>
<br><br>
<br><br>
<br><br>


#GRAPHIC OR SOMETHING THAT EXPLAINS HOW WE DIVDED UP THE QUARTERS TO LOOK AT 2MIN SCORE MARGIN - NEED QUICK EXPLAINTION/UNDERSTANDING OF THIS


#ALL
#### 515 2min intervals that were identified as hacking
#### 5428 2min intervals that were identified as hacking

<div style="text-align: center;">

  <span style="float:left;width: 33%;">
  <IMG SRC="../figs/LA_logo.png" float = "right" ALT="image">
  </span>
  
  <span style="float:left;width: 33%;">
  <IMG SRC="../figs/DET_logo.png" float = "right" ALT="image">
  </span>
  <span style="float:left;width: 33%;">
  <IMG SRC="../figs/hou_logo.png" float = "right" ALT="image">
  </span>

</div>
```{r,results='asis',tidy=FALSE, echo=FALSE, fig.align='center'}

t_plot = all_df
t_plot$HACKINT[t_plot$HACKINT == TRUE] = "Hack"
t_plot$HACKINT[t_plot$HACKINT == FALSE] = "No Hack"

a = ggplot(all_df, aes(SM, fill = HACKINT)) + 
  geom_histogram(binwidth = 1, position = 'identity') +
  theme(legend.position="none")+
  labs( x = 'Two Minute Score Margin', y = 'Frequency')

hack = subset(all_df, HACKINT == TRUE)$SM
no_hack  = subset(all_df, HACKINT == FALSE)$SM
no_hack_mean = round(mean(no_hack),2)
hack_mean = round(mean(hack),2)
#print(length(hack))
#print(length(no_hack))

b = ggplot(t_plot, aes(HACKINT, SM)) + 
  geom_boxplot(aes(fill = factor(HACKINT))) + 
  coord_flip() + 
  theme(legend.position="none") + 
  labs( y = 'Two Minute Score Margin')+
  annotate("text",x = 1.45,y = hack_mean-0.5,label = paste("mean:",hack_mean))+
  annotate("text",x = 2.45,y = no_hack_mean-0.5,label = paste("mean:",no_hack_mean))+ 
  theme(axis.title.y = element_blank())

#summary(subset(TWOMINS1, HACKINT == TRUE)$SM)
#summary(subset(TWOMINS1, HACKINT == FALSE)$SM)
  MainTitle = "2015 Regular Season Games - Jordan,Drummond,Howard,Rice"
  grid.newpage()
  pushViewport(viewport(layout = grid.layout(2, 2, heights = unit(c(0.5, 5), "null"))))
  grid.text(MainTitle, vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))
  print(a, vp = viewport(layout.pos.row = 2, layout.pos.col = 1),newpage=FALSE)
  print(b, vp = viewport(layout.pos.row = 2, layout.pos.col = 2),newpage=FALSE)
  popViewport(1)
  
ttest_all = t.test(hack,no_hack)
print(ttest_all)
```
  
###t-test results
* t: 3.5334
* p-value: 0.0004412
* degrees of freedom: 612.07
* 95% Confidence Intervals: 0.2365976 0.8286634


<br><br>
<br><br>
<br><br>
<br><br>



#CLIPPERS
#### 174 2min intervals that were identified as hacking
#### 1800 2min intervals that were identified as hacking

```{r,results='asis',tidy=FALSE, echo=FALSE, fig.align='center',message=FALSE,warning=FALSE}

t_plot = TWOMINS1
t_plot$HACKINT[t_plot$HACKINT == TRUE] = "Hack"
t_plot$HACKINT[t_plot$HACKINT == FALSE] = "No Hack"

a = ggplot(TWOMINS1, aes(SM, fill = HACKINT)) + 
  geom_histogram(binwidth = 1, position = 'identity') +
  theme(legend.position="none")+
  labs(x = 'Two Minute Score Margin', y = 'Frequency')

hack = subset(TWOMINS1, HACKINT == TRUE)$SM
no_hack  = subset(TWOMINS1, HACKINT == FALSE)$SM
no_hack_mean = round(mean(no_hack),2)
hack_mean = round(mean(hack),2)
#print(length(hack))
#print(length(no_hack))

b = ggplot(t_plot, aes(HACKINT, SM)) + 
  geom_boxplot(aes(fill = factor(HACKINT))) + 
  coord_flip() + 
  theme(legend.position="none") + 
  labs( y = 'Two Minute Score Margin')+
  annotate("text",x = 1.45,y = hack_mean-0.5,label = paste("mean:",hack_mean))+
  annotate("text",x = 2.45,y = no_hack_mean-0.5,label = paste("mean:",no_hack_mean))+ 
  theme(axis.title.y = element_blank())

#summary(subset(TWOMINS1, HACKINT == TRUE)$SM)
#summary(subset(TWOMINS1, HACKINT == FALSE)$SM)
  MainTitle = "LA Clippers 2014 - 2015 (Jordan)"
  grid.newpage()
  pushViewport(viewport(layout = grid.layout(2, 2, heights = unit(c(0.5, 5), "null"))))
  grid.text(MainTitle, vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))
  print(a, vp = viewport(layout.pos.row = 2, layout.pos.col = 1),newpage=FALSE)
  print(b, vp = viewport(layout.pos.row = 2, layout.pos.col = 2),newpage=FALSE)
  popViewport(1)
  


###########################network
library(dplyr)
library(tidyr)
library(RColorBrewer)
library(igraph)
setwd("/Users/sunxiaohan/Desktop/github/finalproject-p5-team3")
#setwd("/Users/bobminnich/Documents/Columbia/Courses/Applied_Data_Science/FinalProject/finalproject-p5-team3")

load('Data/teamDataf.Rdata')

#load the data
gamedata=readRDS('data/Game_Summary_HAS.RDS')
gamedata=gamedata[,c('HTEAM_ID','HTEAM_ABBREVIATION','VTEAM_ID','VTEAM_ABBREVIATION','Hack','HAS_Count')]



hackdata=filter(gamedata,Hack==1)

LAC=filter(hackdata,HTEAM_ABBREVIATION=='LAC'|VTEAM_ABBREVIATION=='LAC')
LAC['OPP']=LAC$HTEAM_ABBREVIATION
ind=(LAC$OPP=='LAC')
LAC=as.matrix(LAC)
LAC[ind,'OPP']=LAC[ind,'VTEAM_ABBREVIATION']
LAC=as.data.frame(LAC)


LAC.new=LAC[,c('HAS_Count','OPP')]
LAC.new$HAS_Count=as.numeric(LAC.new$HAS_Count)

LAC.new=aggregate(LAC.new[,1]~LAC.new[,2],data=LAC.new,FUN=mean)



nodes3=as.data.frame(matrix(nrow=nrow(LAC.new)+1))
nodes3['id']=c('LAC',as.character(LAC.new[,1]))
nodes3=nodes3[,-1]

links3=as.data.frame(matrix(nrow=nrow(LAC.new)))
links3['from']='LAC'
links3['to']=LAC.new$`LAC.new[, 2]`
links3=links3[,-1]
links3['weight']=LAC.new$`LAC.new[, 1]`


net3 <- graph.data.frame(links3, nodes3, directed=T)
V(net3)$size=c(10,links3$weight*8)



V(net3)$color='light blue'


# Set edge width based on weight:
E(net3)$width <- E(net3)$weight/6

#change arrow size and edge color:
E(net3)$arrow.size <- .2
E(net3)$edge.color <- "gray80"
E(net3)$width <- 1+E(net3)$weight/12
E(net3)$length=links3$weight*10

plot(net3,vertex.label.family="Arial Black",main='HAS for LAC') 






##################t test
ttest_la = t.test(hack,no_hack)
print(ttest_la)
```
  
###t-test results
* t: 1.8756  
* p-value: 0.06211  
* degrees of freedom: 209.19  
* 95% Confidence Intervals:  -0.0241699  0.9705684  

<br><br>
<br><br>
<br><br>
<br><br>


#Detroit

#### 181 2min intervals that were identified as hacking
#### 1802 2min intervals that were identified as hacking

```{r,results='asis',tidy=FALSE, echo=FALSE, fig.align='center'}

t_plot = TWOMINS2
t_plot$HACKINT[t_plot$HACKINT == TRUE] = "Hack"
t_plot$HACKINT[t_plot$HACKINT == FALSE] = "No Hack"

a = ggplot(TWOMINS2, aes(SM, fill = HACKINT)) + 
  geom_histogram(binwidth = 1, position = 'identity') +
  theme(legend.position="none")+
  labs(x = 'Two Minute Score Margin', y = 'Frequency')

hack = subset(TWOMINS2, HACKINT == TRUE)$SM
no_hack  = subset(TWOMINS2, HACKINT == FALSE)$SM
no_hack_mean = round(mean(no_hack),2)
hack_mean = round(mean(hack),2)
#print(length(hack))
#print(length(no_hack))

b = ggplot(t_plot, aes(HACKINT, SM)) + 
  geom_boxplot(aes(fill = factor(HACKINT))) + 
  coord_flip() + 
  theme(legend.position="none") + 
  labs( y = 'Two Minute Score Margin')+
  annotate("text",x = 1.45,y = hack_mean-0.5,label = paste("mean:",hack_mean))+
  annotate("text",x = 2.45,y = no_hack_mean-0.5,label = paste("mean:",no_hack_mean))+ 
  theme(axis.title.y = element_blank())

#summary(subset(TWOMINS1, HACKINT == TRUE)$SM)
#summary(subset(TWOMINS1, HACKINT == FALSE)$SM)
  MainTitle = "Detroit Pisons 2014 - 2015 (Drummond)"
  grid.newpage()
  pushViewport(viewport(layout = grid.layout(2, 2, heights = unit(c(0.5, 5), "null"))))
  grid.text(MainTitle, vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))
  print(a, vp = viewport(layout.pos.row = 2, layout.pos.col = 1),newpage=FALSE)
  print(b, vp = viewport(layout.pos.row = 2, layout.pos.col = 2),newpage=FALSE)
  popViewport(1)



###########network plot
DET=filter(hackdata,HTEAM_ABBREVIATION=='DET'|VTEAM_ABBREVIATION=='DET')
DET['OPP']=DET$HTEAM_ABBREVIATION
ind=(DET$OPP=='DET')
DET=as.matrix(DET)
DET[ind,'OPP']=DET[ind,'VTEAM_ABBREVIATION']
DET=as.data.frame(DET)


DET.new=DET[,c('HAS_Count','OPP')]
DET.new$HAS_Count=as.numeric(DET.new$HAS_Count)

DET.new=aggregate(DET.new[,1]~DET.new[,2],data=DET.new,FUN=mean)



nodes1=as.data.frame(matrix(nrow=nrow(DET.new)+1))
nodes1=nodes1[,-1]
nodes1['id']=c('DET',as.character(DET.new[,1]))
nodes1['group']='LL'
nodes1['weight']=c(100,DET.new$`DET.new[, 1]`*50)

links1=as.data.frame(matrix(nrow=nrow(DET.new)))
links1['from']='DET'
links1['to']=DET.new$`DET.new[, 2]`
links1=links1[,-1]
links1['weight']=DET.new$`DET.new[, 1]`





net1 <- graph.data.frame(links1, nodes1, directed=T)
V(net1)$size=c(10,links1$weight*10)



V(net1)$color='light blue'


# Set edge width based on weight:
E(net1)$width <- E(net1)$weight/6

#change arrow size and edge color:
E(net1)$arrow.size <- .2
E(net1)$edge.color <- "gray80"
E(net1)$width <- 1+E(net1)$weight/12
E(net1)$length=links1$weight*10

plot(net1,vertex.label.family="Arial Black",main='HAS for DET') 

##########################t test
  
ttest_det = t.test(hack,no_hack)
print(ttest_det)


```
  
###t-test results
* t: 2.4296  
* p-value: 0.01591  
* degrees of freedom: 222.17  
* 95% Confidence Intervals:  0.1125442 1.0791765  

<br><br>
<br><br>
<br><br>
<br><br>



#Houston

#### 181 2min intervals that were identified as hacking
#### 1802 2min intervals that were identified as hacking

```{r,results='asis',tidy=FALSE, echo=FALSE, fig.align='center'}

t_plot = TWOMINS3
t_plot$HACKINT[t_plot$HACKINT == TRUE] = "Hack"
t_plot$HACKINT[t_plot$HACKINT == FALSE] = "No Hack"

a = ggplot(TWOMINS3, aes(SM, fill = HACKINT)) + 
  geom_histogram(binwidth = 1, position = 'identity') +
  theme(legend.position="none")+
  labs(x = 'Two Minute Score Margin', y = 'Frequency')

hack = subset(TWOMINS3, HACKINT == TRUE)$SM
no_hack  = subset(TWOMINS3, HACKINT == FALSE)$SM
no_hack_mean = round(mean(no_hack),2)
hack_mean = round(mean(hack),2)
print(length(hack))
print(length(no_hack))

b = ggplot(t_plot, aes(HACKINT, SM)) + 
  geom_boxplot(aes(fill = factor(HACKINT))) + 
  coord_flip() + 
  theme(legend.position="none") + 
  labs( y = 'Two Minute Score Margin')+
  annotate("text",x = 1.45,y = hack_mean-0.5,label = paste("mean:",hack_mean))+
  annotate("text",x = 2.45,y = no_hack_mean-0.5,label = paste("mean:",no_hack_mean))+ 
  theme(axis.title.y = element_blank())

#summary(subset(TWOMINS1, HACKINT == TRUE)$SM)
#summary(subset(TWOMINS1, HACKINT == FALSE)$SM)
  MainTitle = "Houston Rockets 2014 - 2015 (Howard and Rice)"
  grid.newpage()
  pushViewport(viewport(layout = grid.layout(2, 2, heights = unit(c(0.5, 5), "null"))))
  grid.text(MainTitle, vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))
  print(a, vp = viewport(layout.pos.row = 2, layout.pos.col = 1),newpage=FALSE)
  print(b, vp = viewport(layout.pos.row = 2, layout.pos.col = 2),newpage=FALSE)
  popViewport(1)



################network plot
HOU=filter(hackdata,HTEAM_ABBREVIATION=='HOU'|VTEAM_ABBREVIATION=='HOU')
HOU['OPP']=HOU$HTEAM_ABBREVIATION
ind=(HOU$OPP=='HOU')
HOU=as.matrix(HOU)
HOU[ind,'OPP']=HOU[ind,'VTEAM_ABBREVIATION']
HOU=as.data.frame(HOU)


HOU.new=HOU[,c('HAS_Count','OPP')]
HOU.new$HAS_Count=as.numeric(HOU.new$HAS_Count)

HOU.new=aggregate(HOU.new[,1]~HOU.new[,2],data=HOU.new,FUN=mean)



nodes2=as.data.frame(matrix(nrow=nrow(HOU.new)+1))
nodes2['id']=c('HOU',as.character(HOU.new[,1]))
nodes2=nodes2[,-1]

links2=as.data.frame(matrix(nrow=nrow(HOU.new)))
links2['from']='HOU'
links2['to']=HOU.new$`HOU.new[, 2]`
links2=links2[,-1]
links2['weight']=HOU.new$`HOU.new[, 1]`


net2 <- graph.data.frame(links2, nodes2, directed=T)
V(net2)$size=c(10,links2$weight*8)



V(net2)$color='light blue'


# Set edge width based on weight:
E(net2)$width <- E(net2)$weight/6

#change arrow size and edge color:
E(net2)$arrow.size <- .2
E(net2)$edge.color <- "gray80"
E(net2)$width <- 1+E(net2)$weight/12
E(net2)$length=links2$weight*10

plot(net2,vertex.label.family="Arial Black",main='HOU')


#######################t test
  
ttest_hou = t.test(hack,no_hack)
print(ttest_hou)



```
  
###t-test results
* t: 1.7703  
* p-value: 0.07836  
* degrees of freedom: 181.21  
* 95% Confidence Intervals: -0.05876789  1.08453459  



<br><br>
<br><br>
<br><br>
<br><br>

#Conclusion

## NBA API
<span style="float:middle;width: 30%;">
  <IMG SRC="../figs/API.png" float = "right" ALT="image">
  </span>

<https://github.com/TZstatsADS/finalproject-p5-team3/tree/master/NBA_API>
    

Do we recommend Hack - A - Shaq